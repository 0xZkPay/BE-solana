# Solana ZK Pay Backend

## API Reference

### APIs

### On board

#### Returns flow ID and EULA which should be signed and send to authenticate API in order to get the PASETO and api_key which can be used for accessing all other APIs

```
  POST /on-board/flowid
```

| Parameter | Type     | Description                                                      |
| :-------- | :------- | :--------------------------------------------------------------- |
| `addr`    | `string` | **Required**. address for which to initiate verification process |

#### Returns PASETO and api_key which can be used for accessing all other APIs

```
  POST /on-board/verify
```

| Parameter    | Type     | Description                                                  |
| :----------- | :------- | :----------------------------------------------------------- |
| `flowid`     | `string` | **Required**. flow id received in `/flowid` api              |
| `public_key` | `string` | **Required**. address to verify                              |
| `signature`  | `string` | **Required**. signature generated by signing `flowid`+`eula` |
| `name`       | `string` | **Required**. name of user                                   |
| `city`       | `string` | **Required**. city of user                                   |

### Manage

Header `authorization` is required to access this apis.

#### Generate new api key for merchant

```
  POST /manage/api-key
```

| Parameter | Type     | Description               |
| :-------- | :------- | :------------------------ |
| `id`      | `string` | **Required**. merchant id |

#### Create merchant

```
  POST /manage/merchant
```

| Parameter        | Type     | Description                                                |
| :--------------- | :------- | :--------------------------------------------------------- |
| `name`           | `string` | **Required**. merchant name                                |
| `type`           | `string` | **Required**. merchant type                                |
| `payout_address` | `string` | **Required**. address where all payments will be collected |
| `domain`         | `string` | **Required**. merchant domain                              |

#### Get merchants

```
  GET /manage/merchant
```

| Parameter(query) | Type     | Description                                         |
| :--------------- | :------- | :-------------------------------------------------- |
| `id`             | `string` | **Optional** only return merchant with specified id |

#### Update merchant

```
  PATCH /manage/merchant
```

| Parameter        | Type     | Description                                              |
| :--------------- | :------- | :------------------------------------------------------- |
| `id`             | `string` | **Required** merchant id                                 |
| `name`           | `string` | **Optional** merchant name                               |
| `type`           | `string` | **Optional** merchant type                               |
| `payout_address` | `string` | **Optional** address where all payments will be collecte |
| `domain`         | `string` | **Optional** merchant domain                             |

#### Get User details

```
  GET /manage/user
```

#### Update User details

```
  PATCH /manage/user
```

| Parameter | Type     | Description               |
| :-------- | :------- | :------------------------ |
| `name`    | `string` | **Optional** name of user |
| `city`    | `string` | **Optional** city of user |

### Core

Header `api_key` is required to access this apis.

#### Create a new payment flow with the expected amount to be received.

```
  POST /core/new-payment
```

| Parameter        | Type     | Description                                  |
| :--------------- | :------- | :------------------------------------------- |
| `amount_lamport` | `number` | **Required**. expected amount to be received |

#### Update the payment status by checking the latest transaction with expected amount

```
  POST /core/update-payment
```

| Parameter | Type     | Description                                                    |
| :-------- | :------- | :------------------------------------------------------------- |
| `addr`    | `string` | **Required**. the receiving address returned by `/new-payment` |
